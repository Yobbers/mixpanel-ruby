<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Mixpanel::Events - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-import">#import</a>
    
    <li ><a href="#method-i-track">#track</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Mixpanel::Events">
  <h1 id="class-Mixpanel::Events" class="class">
    class Mixpanel::Events
  </h1>

  <section class="description">
    
<p>Handles formatting <a href="../Mixpanel.html">Mixpanel</a> event tracking
messages and sending them to the consumer. <a
href="Tracker.html">Mixpanel::Tracker</a> is a subclass of this class, and
the best way to track events is to instantiate a <a
href="Tracker.html">Mixpanel::Tracker</a></p>

<pre>tracker = Mixpanel::Tracker.new(YOUR_MIXPANEL_TOKEN) # Has all of the methods of Mixpanel::Event
tracker.track(...)</pre>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(token, error_handler=nil, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>You likely won&#39;t need to instantiate an instance of <a
href="Events.html">Mixpanel::Events</a> directly. The best way to get an
instance is to use <a href="Tracker.html">Mixpanel::Tracker</a></p>

<pre class="ruby"><span class="ruby-comment"># tracker has all of the methods of Mixpanel::Events</span>
<span class="ruby-identifier">tracker</span> = <span class="ruby-constant">Mixpanel</span><span class="ruby-operator">::</span><span class="ruby-constant">Tracker</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">YOUR_MIXPANEL_TOKEN</span>)
</pre>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/mixpanel-ruby/events.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">token</span>, <span class="ruby-identifier">error_handler</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@token</span> = <span class="ruby-identifier">token</span>
  <span class="ruby-ivar">@error_handler</span> = <span class="ruby-identifier">error_handler</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ErrorHandler</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
    <span class="ruby-ivar">@sink</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">consumer</span> = <span class="ruby-constant">Consumer</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@sink</span> = <span class="ruby-identifier">consumer</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:send!</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">import</span><span
            class="method-args">(api_key, distinct_id, event, properties={}, ip=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Imports an event that has occurred in the past, along with a distinct_id
representing the source of that event (for example, a user id), an event
name describing the event and a set of properties describing that event.
Properties are provided as a Hash with string keys and strings, numbers or
booleans as values.  By default, we pass the time of the method call as the
time the event occured, if you wish to override this pass a timestamp in
the properties hash.</p>

<pre class="ruby"><span class="ruby-identifier">tracker</span> = <span class="ruby-constant">Mixpanel</span><span class="ruby-operator">::</span><span class="ruby-constant">Tracker</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">YOUR_MIXPANEL_TOKEN</span>)

<span class="ruby-comment"># Track that user &quot;12345&quot;&#39;s credit card was declined</span>
<span class="ruby-identifier">tracker</span>.<span class="ruby-identifier">import</span>(<span class="ruby-string">&quot;API_KEY&quot;</span>, <span class="ruby-string">&quot;12345&quot;</span>, <span class="ruby-string">&quot;Credit Card Declined&quot;</span>)

<span class="ruby-comment"># Properties describe the circumstances of the event,</span>
<span class="ruby-comment"># or aspects of the source or user associated with the event</span>
<span class="ruby-identifier">tracker</span>.<span class="ruby-identifier">import</span>(<span class="ruby-string">&quot;API_KEY&quot;</span>, <span class="ruby-string">&quot;12345&quot;</span>, <span class="ruby-string">&quot;Welcome Email Sent&quot;</span>, {
    <span class="ruby-string">&#39;Email Template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Pretty Pink Welcome&#39;</span>,
    <span class="ruby-string">&#39;User Sign-up Cohort&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;July 2013&#39;</span>,
    <span class="ruby-string">&#39;time&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">1369353600</span>,
})
</pre>
          
          

          
          <div class="method-source-code" id="import-source">
            <pre><span class="ruby-comment"># File lib/mixpanel-ruby/events.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">import</span>(<span class="ruby-identifier">api_key</span>, <span class="ruby-identifier">distinct_id</span>, <span class="ruby-identifier">event</span>, <span class="ruby-identifier">properties</span>={}, <span class="ruby-identifier">ip</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">properties</span> = {
    <span class="ruby-string">&#39;distinct_id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">distinct_id</span>,
    <span class="ruby-string">&#39;token&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@token</span>,
    <span class="ruby-string">&#39;time&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>,
    <span class="ruby-string">&#39;mp_lib&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;ruby&#39;</span>,
    <span class="ruby-string">&#39;$lib_version&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Mixpanel</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>,
  }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">properties</span>)
  <span class="ruby-identifier">properties</span>[<span class="ruby-string">&#39;ip&#39;</span>] = <span class="ruby-identifier">ip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ip</span>

  <span class="ruby-identifier">data</span> = {
    <span class="ruby-string">&#39;event&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">event</span>,
    <span class="ruby-string">&#39;properties&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">properties</span>,
  }

  <span class="ruby-identifier">message</span> = {
    <span class="ruby-string">&#39;data&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">data</span>,
    <span class="ruby-string">&#39;api_key&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">api_key</span>,
  }

  <span class="ruby-identifier">ret</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@sink</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">:import</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_json</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">MixpanelError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-ivar">@error_handler</span>.<span class="ruby-identifier">handle</span>(<span class="ruby-identifier">e</span>)
    <span class="ruby-identifier">ret</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">ret</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-track" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">track</span><span
            class="method-args">(distinct_id, event, properties={}, ip=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Notes that an event has occurred, along with a distinct_id representing the
source of that event (for example, a user id), an event name describing the
event and a set of properties describing that event. Properties are
provided as a Hash with string keys and strings, numbers or booleans as
values.</p>

<pre class="ruby"><span class="ruby-identifier">tracker</span> = <span class="ruby-constant">Mixpanel</span><span class="ruby-operator">::</span><span class="ruby-constant">Tracker</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">YOUR_MIXPANEL_TOKEN</span>)

<span class="ruby-comment"># Track that user &quot;12345&quot;&#39;s credit card was declined</span>
<span class="ruby-identifier">tracker</span>.<span class="ruby-identifier">track</span>(<span class="ruby-string">&quot;12345&quot;</span>, <span class="ruby-string">&quot;Credit Card Declined&quot;</span>)

<span class="ruby-comment"># Properties describe the circumstances of the event,</span>
<span class="ruby-comment"># or aspects of the source or user associated with the event</span>
<span class="ruby-identifier">tracker</span>.<span class="ruby-identifier">track</span>(<span class="ruby-string">&quot;12345&quot;</span>, <span class="ruby-string">&quot;Welcome Email Sent&quot;</span>, {
    <span class="ruby-string">&#39;Email Template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Pretty Pink Welcome&#39;</span>,
    <span class="ruby-string">&#39;User Sign-up Cohort&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;July 2013&#39;</span>
})
</pre>
          
          

          
          <div class="method-source-code" id="track-source">
            <pre><span class="ruby-comment"># File lib/mixpanel-ruby/events.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">track</span>(<span class="ruby-identifier">distinct_id</span>, <span class="ruby-identifier">event</span>, <span class="ruby-identifier">properties</span>={}, <span class="ruby-identifier">ip</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">properties</span> = {
    <span class="ruby-string">&#39;distinct_id&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">distinct_id</span>,
    <span class="ruby-string">&#39;token&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@token</span>,
    <span class="ruby-string">&#39;time&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>,
    <span class="ruby-string">&#39;mp_lib&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;ruby&#39;</span>,
    <span class="ruby-string">&#39;$lib_version&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Mixpanel</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>,
  }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">properties</span>)
  <span class="ruby-identifier">properties</span>[<span class="ruby-string">&#39;ip&#39;</span>] = <span class="ruby-identifier">ip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ip</span>

  <span class="ruby-identifier">data</span> = {
    <span class="ruby-string">&#39;event&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">event</span>,
    <span class="ruby-string">&#39;properties&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">properties</span>,
  }

  <span class="ruby-identifier">message</span> = {<span class="ruby-string">&#39;data&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">data</span>}

  <span class="ruby-identifier">ret</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@sink</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">:event</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_json</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">MixpanelError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-ivar">@error_handler</span>.<span class="ruby-identifier">handle</span>(<span class="ruby-identifier">e</span>)
    <span class="ruby-identifier">ret</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">ret</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.0.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

